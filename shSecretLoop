--// CONFIGURACIÃ“N
_G.tplayer = "fred_tw" -- tu usuario actual de Roblox
getgenv().loopgoto = true

--// FPS CAP (recomendado para clones: 12â€“20)
local TARGET_FPS = 15
if setfpscap then
    pcall(function() setfpscap(TARGET_FPS) end)
end

--// SERVICIOS
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local VirtualUser = game:GetService("VirtualUser")
local Lighting = game:GetService("Lighting")
local player = Players.LocalPlayer

--// FUNCIÃ“N: encontrar jugador
local function findTarget(name)
    for _, plr in ipairs(Players:GetPlayers()) do
        if string.lower(plr.Name) == string.lower(name) or string.lower(plr.DisplayName) == string.lower(name) then
            return plr
        end
    end
end

--// FUNCIONES DE POSICIÃ“N
local function getCircleOffset(index, total)
    local radius = math.clamp(total * 1.2, 3.5, 5.5)
    local angle = ((index - 1) / total) * (2 * math.pi)
    return Vector3.new(math.cos(angle) * radius, 0, math.sin(angle) * radius)
end

local function getMyOffset()
    local clones = {}
    for _, plr in ipairs(Players:GetPlayers()) do
        table.insert(clones, plr)
    end
    table.sort(clones, function(a, b) return a.UserId < b.UserId end)
    local myIndex = 1
    for i, plr in ipairs(clones) do
        if plr == player then
            myIndex = i
            break
        end
    end
    return getCircleOffset(myIndex, #clones)
end

--// Offset dinÃ¡mico
local myOffset = getMyOffset()
Players.PlayerAdded:Connect(function() myOffset = getMyOffset() end)
Players.PlayerRemoving:Connect(function() myOffset = getMyOffset() end)

--// No colisiones
local function NoCollideCharacter(char)
    for _, part in pairs(char:GetDescendants()) do
        if part:IsA("BasePart") then
            part.CanCollide = false
        end
    end
    char.DescendantAdded:Connect(function(part)
        if part:IsA("BasePart") then
            part.CanCollide = false
        end
    end)
end
player.CharacterAdded:Connect(NoCollideCharacter)
if player.Character then NoCollideCharacter(player.Character) end

--// AUTO FOLLOW LOOP
task.spawn(function()
    local offsetUpdateTimer = 0
    while getgenv().loopgoto do
        RunService.Heartbeat:Wait()
        pcall(function()
            offsetUpdateTimer += RunService.Heartbeat:Wait()
            if offsetUpdateTimer >= 5 then
                myOffset = getMyOffset()
                offsetUpdateTimer = 0
            end

            local target = findTarget(_G.tplayer)
            if not target then return end

            local targetRoot = target.Character and target.Character:FindFirstChild("HumanoidRootPart")
            local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")

            if root and targetRoot then
                local targetPos = targetRoot.CFrame * CFrame.new(myOffset)
                root.CFrame = root.CFrame:Lerp(targetPos, 0.35)
                if (root.Position - targetRoot.Position).Magnitude > 25 then
                    root.CFrame = targetPos
                end
                if root.Position.Y < -10 then
                    root.CFrame = targetRoot.CFrame * CFrame.new(0, 5, 0)
                end
            end
        end)
    end
end)

--// ANTI AFK
player.Idled:Connect(function()
    VirtualUser:Button2Down(Vector2.new(), workspace.CurrentCamera.CFrame)
    task.wait(1)
    VirtualUser:Button2Up(Vector2.new(), workspace.CurrentCamera.CFrame)
end)

--// ANTI LAG ULTRA BESTIA
task.spawn(function()
    local function clearVisual(obj)
        if not obj then return end
        if obj:IsA("ParticleEmitter") or obj:IsA("Trail") or obj:IsA("Beam")
        or obj:IsA("Fire") or obj:IsA("Smoke") or obj:IsA("Explosion")
        or obj:IsA("Decal") or obj:IsA("Texture") or obj:IsA("SurfaceAppearance")
        or obj:IsA("Highlight") or obj:IsA("BillboardGui") or obj:IsA("SurfaceGui")
        or obj:IsA("VideoFrame") or obj:IsA("ViewportFrame") then
            pcall(function() obj:Destroy() end)
        elseif obj:IsA("Sound") then
            pcall(function() obj.Playing = false end)
        elseif obj:IsA("BasePart") then
            pcall(function()
                obj.Material = Enum.Material.SmoothPlastic
                obj.Transparency = 1
                local mesh = obj:FindFirstChildOfClass("SpecialMesh")
                if mesh then mesh:Destroy() end
            end)
        elseif obj:IsA("ForceField") then
            pcall(function() obj.Visible = false end) -- ðŸ”¥ oculta el aura azul localmente
        end
    end

    for _,v in pairs(workspace:GetDescendants()) do
        pcall(clearVisual, v)
    end
    for _,plr in pairs(Players:GetPlayers()) do
        if plr.Character then
            for _, part in pairs(plr.Character:GetDescendants()) do
                pcall(clearVisual, part)
            end
        end
    end

    workspace.DescendantAdded:Connect(function(obj) pcall(clearVisual, obj) end)
    Lighting.DescendantAdded:Connect(function(obj) pcall(clearVisual, obj) end)
    Players.PlayerAdded:Connect(function(plr)
        plr.CharacterAdded:Connect(function(char)
            char.DescendantAdded:Connect(function(obj) pcall(clearVisual, obj) end)
        end)
    end)

    RunService.RenderStepped:Connect(function()
        pcall(function()
            Lighting.GlobalShadows = false
            Lighting.Brightness = 0
            Lighting.FogEnd = 0
            Lighting.OutdoorAmbient = Color3.new(0,0,0)
            Lighting.Ambient = Color3.new(0,0,0)
            if workspace.CurrentCamera then
                workspace.CurrentCamera.CameraType = Enum.CameraType.Scriptable
                workspace.CurrentCamera.CFrame = CFrame.new(0,1e6,0)
            end
        end)
    end)
end)
